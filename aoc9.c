#define _CRT_SECURE_NO_WARNINGS
#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include <string.h>
#include <stdbool.h>

// byte-based types (are you shocked and appalled?)
typedef uint8_t  U1;
typedef uint32_t U4;
typedef int32_t  S4;
typedef uint64_t U8;
#define countof(a) (sizeof(a)/sizeof(*(a)))

bool dbg_print = false;

#if 0
char const *ops[] = {
    "R 4",
    "U 4",
    "L 3",
    "D 1",
    "R 4",
    "D 1",
    "L 5",
    "R 2",
};

//
//
//   ###..
//   #3#..
//  .##2..
//  ....1.
//
//   ###..
//   #3#..
//  .##2..
//  .....1
//
//   ###..
//   #4#..
//  .##3..
//  ....21
//
//

#elif 0
char const *ops[] = {
    "R 5",
    "U 8",
    "L 8",
    "D 3",
    "R 17",
    "D 10",
    "L 25",
    "U 20",
};

#else
char const *ops[] = {
    "D 2",
    "U 2",
    "L 2",
    "D 2",
    "L 2",
    "D 2",
    "L 1",
    "D 2",
    "U 1",
    "L 1",
    "D 1",
    "R 1",
    "D 1",
    "L 2",
    "D 1",
    "U 2",
    "D 2",
    "R 2",
    "D 1",
    "U 2",
    "L 2",
    "D 1",
    "R 1",
    "D 1",
    "R 2",
    "U 2",
    "L 2",
    "U 2",
    "D 1",
    "U 2",
    "R 2",
    "L 2",
    "R 2",
    "D 2",
    "L 1",
    "R 2",
    "D 2",
    "R 2",
    "D 1",
    "R 2",
    "D 2",
    "R 2",
    "L 1",
    "R 1",
    "U 2",
    "D 2",
    "R 2",
    "D 1",
    "L 2",
    "D 1",
    "L 1",
    "U 2",
    "L 1",
    "U 2",
    "R 2",
    "D 1",
    "L 1",
    "D 2",
    "L 1",
    "D 1",
    "R 1",
    "D 2",
    "R 2",
    "D 2",
    "L 2",
    "D 2",
    "U 2",
    "L 1",
    "R 2",
    "L 1",
    "D 2",
    "L 2",
    "D 2",
    "U 2",
    "L 1",
    "R 2",
    "U 2",
    "D 2",
    "R 1",
    "L 2",
    "D 1",
    "R 2",
    "D 2",
    "L 1",
    "R 1",
    "L 2",
    "D 1",
    "R 1",
    "D 1",
    "L 1",
    "U 2",
    "R 1",
    "U 1",
    "L 1",
    "U 1",
    "L 2",
    "U 2",
    "L 2",
    "U 2",
    "R 1",
    "L 2",
    "D 2",
    "R 1",
    "D 1",
    "U 2",
    "D 1",
    "U 1",
    "L 1",
    "R 1",
    "D 2",
    "R 1",
    "D 2",
    "U 1",
    "D 2",
    "L 1",
    "R 2",
    "U 2",
    "D 3",
    "U 1",
    "R 1",
    "U 1",
    "D 1",
    "R 1",
    "L 2",
    "D 3",
    "U 3",
    "L 3",
    "U 2",
    "R 2",
    "U 1",
    "D 2",
    "U 1",
    "R 3",
    "D 1",
    "R 2",
    "U 1",
    "D 2",
    "U 2",
    "L 2",
    "U 1",
    "D 1",
    "L 2",
    "U 3",
    "R 3",
    "D 3",
    "R 1",
    "U 1",
    "L 3",
    "R 1",
    "D 1",
    "L 1",
    "U 1",
    "R 3",
    "U 2",
    "D 1",
    "U 1",
    "L 2",
    "U 3",
    "L 2",
    "D 3",
    "L 2",
    "R 3",
    "D 3",
    "R 3",
    "L 2",
    "R 3",
    "U 3",
    "D 1",
    "U 2",
    "L 3",
    "U 2",
    "L 1",
    "U 1",
    "D 1",
    "L 1",
    "D 2",
    "U 2",
    "L 1",
    "U 1",
    "L 3",
    "U 2",
    "D 3",
    "R 1",
    "U 1",
    "R 3",
    "L 3",
    "R 2",
    "U 1",
    "L 3",
    "D 2",
    "U 1",
    "D 3",
    "R 2",
    "U 3",
    "L 1",
    "R 2",
    "D 2",
    "L 1",
    "R 3",
    "L 3",
    "D 3",
    "R 3",
    "L 2",
    "U 2",
    "R 3",
    "D 2",
    "L 2",
    "U 1",
    "R 2",
    "U 2",
    "R 3",
    "L 2",
    "D 1",
    "R 1",
    "D 3",
    "L 3",
    "U 1",
    "R 2",
    "L 3",
    "D 1",
    "R 3",
    "U 2",
    "D 4",
    "L 2",
    "D 2",
    "L 2",
    "R 3",
    "U 2",
    "D 1",
    "R 3",
    "L 2",
    "U 3",
    "R 3",
    "U 3",
    "L 4",
    "R 3",
    "D 3",
    "U 1",
    "D 2",
    "R 1",
    "U 1",
    "L 2",
    "D 1",
    "R 2",
    "U 4",
    "R 3",
    "U 3",
    "L 4",
    "U 3",
    "R 2",
    "L 1",
    "R 4",
    "L 2",
    "U 4",
    "L 1",
    "D 1",
    "L 1",
    "U 2",
    "L 1",
    "U 3",
    "L 1",
    "U 1",
    "R 1",
    "U 1",
    "R 2",
    "L 4",
    "D 3",
    "R 4",
    "D 2",
    "U 2",
    "L 2",
    "D 1",
    "R 2",
    "L 4",
    "U 4",
    "R 3",
    "D 3",
    "L 2",
    "R 3",
    "L 2",
    "D 4",
    "R 4",
    "L 1",
    "R 3",
    "U 3",
    "R 4",
    "L 4",
    "U 3",
    "R 2",
    "D 3",
    "L 3",
    "D 1",
    "U 2",
    "D 1",
    "L 4",
    "D 3",
    "R 4",
    "L 4",
    "U 3",
    "R 2",
    "U 1",
    "D 3",
    "R 3",
    "D 4",
    "U 3",
    "L 3",
    "D 4",
    "L 2",
    "U 2",
    "L 2",
    "D 2",
    "U 2",
    "L 2",
    "D 3",
    "R 4",
    "U 2",
    "D 3",
    "R 2",
    "D 4",
    "U 2",
    "R 2",
    "D 3",
    "L 2",
    "U 1",
    "L 4",
    "R 2",
    "L 4",
    "D 3",
    "L 1",
    "D 1",
    "U 2",
    "L 1",
    "R 4",
    "L 4",
    "R 2",
    "L 3",
    "R 5",
    "D 5",
    "L 4",
    "U 2",
    "R 2",
    "U 3",
    "D 4",
    "L 2",
    "U 3",
    "D 2",
    "R 2",
    "D 1",
    "R 5",
    "D 1",
    "R 2",
    "U 5",
    "R 3",
    "D 5",
    "L 2",
    "R 5",
    "L 4",
    "R 2",
    "U 3",
    "L 3",
    "D 2",
    "L 1",
    "D 5",
    "L 1",
    "R 1",
    "U 2",
    "R 4",
    "L 5",
    "R 2",
    "D 2",
    "U 1",
    "L 3",
    "D 2",
    "R 2",
    "U 4",
    "D 5",
    "R 4",
    "U 3",
    "R 1",
    "D 2",
    "R 4",
    "L 3",
    "D 4",
    "L 4",
    "R 4",
    "D 4",
    "L 5",
    "R 5",
    "D 2",
    "R 2",
    "L 1",
    "D 5",
    "L 3",
    "R 3",
    "U 4",
    "R 1",
    "U 3",
    "L 4",
    "D 5",
    "R 3",
    "D 4",
    "U 5",
    "L 5",
    "R 5",
    "U 3",
    "L 2",
    "D 4",
    "U 1",
    "R 4",
    "U 2",
    "D 2",
    "U 2",
    "L 1",
    "U 2",
    "D 1",
    "U 4",
    "R 3",
    "U 1",
    "R 2",
    "L 5",
    "D 3",
    "R 1",
    "U 3",
    "L 2",
    "U 5",
    "D 5",
    "U 3",
    "D 4",
    "R 1",
    "U 5",
    "L 4",
    "U 5",
    "R 3",
    "D 5",
    "U 1",
    "D 1",
    "L 1",
    "U 2",
    "L 3",
    "R 1",
    "U 2",
    "D 5",
    "R 5",
    "U 1",
    "L 1",
    "R 6",
    "D 1",
    "L 6",
    "D 2",
    "U 6",
    "R 4",
    "D 3",
    "R 1",
    "U 1",
    "L 3",
    "U 6",
    "D 4",
    "R 4",
    "D 4",
    "R 5",
    "D 6",
    "L 5",
    "U 3",
    "R 6",
    "U 6",
    "D 2",
    "U 4",
    "L 5",
    "D 3",
    "L 2",
    "R 6",
    "D 5",
    "R 2",
    "U 1",
    "R 6",
    "L 3",
    "R 4",
    "U 5",
    "L 1",
    "D 2",
    "U 5",
    "R 4",
    "D 6",
    "R 6",
    "D 1",
    "U 2",
    "R 5",
    "D 6",
    "R 3",
    "U 3",
    "L 3",
    "R 1",
    "L 4",
    "R 1",
    "D 5",
    "U 5",
    "L 6",
    "U 3",
    "D 3",
    "R 6",
    "D 6",
    "R 1",
    "D 4",
    "L 2",
    "D 5",
    "R 4",
    "U 2",
    "R 5",
    "L 1",
    "D 6",
    "U 6",
    "R 5",
    "U 4",
    "D 4",
    "U 6",
    "L 6",
    "D 1",
    "L 6",
    "R 1",
    "D 3",
    "R 4",
    "L 5",
    "D 2",
    "L 5",
    "R 2",
    "U 5",
    "D 3",
    "R 6",
    "U 1",
    "D 1",
    "R 6",
    "U 6",
    "D 1",
    "L 4",
    "D 4",
    "L 1",
    "U 5",
    "R 2",
    "L 3",
    "U 5",
    "R 4",
    "L 6",
    "R 5",
    "D 5",
    "L 4",
    "R 6",
    "U 3",
    "R 3",
    "D 3",
    "R 5",
    "U 3",
    "R 4",
    "U 3",
    "L 4",
    "U 4",
    "L 5",
    "R 6",
    "U 5",
    "D 1",
    "U 4",
    "L 7",
    "D 7",
    "U 5",
    "R 3",
    "D 4",
    "R 4",
    "D 3",
    "L 1",
    "U 4",
    "L 2",
    "D 4",
    "R 4",
    "U 7",
    "L 7",
    "U 4",
    "D 7",
    "U 6",
    "D 3",
    "U 6",
    "L 6",
    "R 1",
    "D 1",
    "R 3",
    "D 5",
    "U 1",
    "L 5",
    "R 5",
    "U 3",
    "L 7",
    "R 6",
    "D 7",
    "U 3",
    "L 2",
    "U 1",
    "R 3",
    "L 2",
    "U 1",
    "R 7",
    "U 1",
    "D 7",
    "U 4",
    "R 6",
    "U 2",
    "R 3",
    "U 6",
    "D 2",
    "L 4",
    "D 2",
    "L 2",
    "U 2",
    "L 2",
    "D 6",
    "R 2",
    "D 1",
    "U 4",
    "D 4",
    "U 4",
    "R 2",
    "U 3",
    "R 2",
    "D 1",
    "R 1",
    "L 7",
    "R 2",
    "D 6",
    "L 6",
    "D 2",
    "L 6",
    "R 3",
    "L 5",
    "D 7",
    "U 3",
    "R 5",
    "D 1",
    "U 7",
    "D 7",
    "U 4",
    "R 5",
    "D 1",
    "U 7",
    "L 6",
    "D 7",
    "U 5",
    "L 5",
    "U 4",
    "R 4",
    "U 7",
    "D 3",
    "R 7",
    "U 2",
    "R 2",
    "L 4",
    "R 6",
    "U 5",
    "R 6",
    "L 5",
    "U 1",
    "D 7",
    "U 1",
    "D 1",
    "L 6",
    "D 6",
    "U 2",
    "L 3",
    "U 6",
    "L 6",
    "R 6",
    "U 5",
    "L 4",
    "R 1",
    "L 1",
    "D 4",
    "L 5",
    "D 3",
    "L 4",
    "R 6",
    "L 6",
    "D 6",
    "U 5",
    "D 1",
    "R 2",
    "D 6",
    "R 6",
    "U 8",
    "L 8",
    "U 7",
    "D 7",
    "R 3",
    "U 4",
    "R 4",
    "U 8",
    "D 4",
    "R 6",
    "D 1",
    "L 6",
    "D 6",
    "R 8",
    "U 1",
    "D 2",
    "R 3",
    "D 8",
    "U 4",
    "R 3",
    "U 7",
    "R 3",
    "D 6",
    "L 8",
    "D 3",
    "L 7",
    "R 1",
    "L 7",
    "D 5",
    "U 3",
    "D 7",
    "U 4",
    "D 7",
    "L 7",
    "D 2",
    "U 7",
    "R 5",
    "U 5",
    "L 4",
    "D 3",
    "R 6",
    "U 1",
    "L 3",
    "D 3",
    "R 2",
    "U 3",
    "D 2",
    "R 3",
    "D 3",
    "R 3",
    "L 3",
    "D 6",
    "U 2",
    "L 2",
    "R 5",
    "U 4",
    "D 2",
    "U 5",
    "L 3",
    "R 1",
    "U 5",
    "D 1",
    "U 5",
    "L 3",
    "D 6",
    "R 6",
    "D 1",
    "U 4",
    "L 2",
    "D 5",
    "U 2",
    "L 8",
    "U 6",
    "D 6",
    "R 7",
    "L 3",
    "D 3",
    "L 1",
    "R 2",
    "D 5",
    "L 1",
    "D 3",
    "L 3",
    "R 8",
    "L 3",
    "D 7",
    "R 4",
    "U 3",
    "R 1",
    "L 7",
    "D 1",
    "U 1",
    "R 4",
    "L 2",
    "U 2",
    "L 5",
    "D 4",
    "R 8",
    "U 3",
    "R 7",
    "L 9",
    "R 5",
    "U 8",
    "R 9",
    "U 1",
    "D 2",
    "U 5",
    "L 5",
    "R 5",
    "U 3",
    "R 1",
    "U 7",
    "D 2",
    "R 2",
    "L 4",
    "D 7",
    "U 4",
    "R 3",
    "D 6",
    "R 9",
    "L 1",
    "D 1",
    "U 2",
    "R 8",
    "D 4",
    "L 2",
    "U 7",
    "D 9",
    "U 8",
    "D 4",
    "R 1",
    "L 3",
    "R 6",
    "D 6",
    "R 1",
    "L 2",
    "R 9",
    "U 7",
    "R 4",
    "U 2",
    "D 6",
    "L 5",
    "U 5",
    "R 2",
    "L 5",
    "R 1",
    "D 6",
    "R 1",
    "D 5",
    "L 4",
    "U 1",
    "D 8",
    "L 9",
    "R 1",
    "U 6",
    "D 3",
    "L 7",
    "U 7",
    "R 5",
    "D 8",
    "U 2",
    "D 8",
    "U 4",
    "L 2",
    "R 4",
    "D 4",
    "L 6",
    "R 4",
    "L 5",
    "U 7",
    "R 8",
    "L 6",
    "D 9",
    "L 2",
    "R 4",
    "L 6",
    "U 3",
    "L 6",
    "R 9",
    "U 7",
    "D 3",
    "R 1",
    "D 1",
    "R 6",
    "D 8",
    "L 5",
    "R 8",
    "U 9",
    "D 9",
    "U 2",
    "R 7",
    "U 9",
    "R 4",
    "L 6",
    "U 9",
    "R 2",
    "D 9",
    "U 7",
    "R 2",
    "U 9",
    "R 2",
    "L 2",
    "R 8",
    "L 9",
    "R 3",
    "D 4",
    "R 10",
    "U 10",
    "D 7",
    "R 7",
    "D 4",
    "R 8",
    "D 9",
    "U 7",
    "L 8",
    "D 10",
    "U 10",
    "R 4",
    "U 6",
    "D 4",
    "L 9",
    "R 9",
    "L 10",
    "D 3",
    "L 6",
    "D 2",
    "L 5",
    "U 1",
    "R 4",
    "D 3",
    "U 7",
    "L 1",
    "R 6",
    "L 10",
    "U 2",
    "R 4",
    "D 5",
    "U 7",
    "R 2",
    "U 3",
    "R 3",
    "L 2",
    "R 9",
    "U 8",
    "D 8",
    "R 10",
    "U 9",
    "R 6",
    "U 5",
    "L 2",
    "D 10",
    "U 4",
    "R 4",
    "L 5",
    "U 10",
    "R 6",
    "L 1",
    "R 10",
    "D 9",
    "L 7",
    "D 3",
    "L 3",
    "R 5",
    "D 3",
    "L 2",
    "R 1",
    "L 3",
    "R 2",
    "D 2",
    "U 4",
    "L 3",
    "D 5",
    "R 6",
    "D 1",
    "U 8",
    "L 6",
    "D 10",
    "R 6",
    "U 5",
    "L 1",
    "D 8",
    "U 1",
    "R 2",
    "D 6",
    "U 8",
    "D 10",
    "L 2",
    "D 1",
    "R 7",
    "L 2",
    "D 4",
    "U 10",
    "L 7",
    "D 10",
    "U 2",
    "D 7",
    "U 1",
    "R 5",
    "D 8",
    "R 4",
    "D 9",
    "R 6",
    "L 6",
    "R 7",
    "L 2",
    "R 5",
    "D 6",
    "L 2",
    "D 1",
    "L 9",
    "U 4",
    "D 10",
    "R 10",
    "U 7",
    "D 10",
    "U 7",
    "L 8",
    "U 9",
    "L 2",
    "D 7",
    "R 4",
    "D 10",
    "R 1",
    "L 5",
    "U 11",
    "L 2",
    "R 9",
    "L 6",
    "U 10",
    "D 1",
    "L 8",
    "U 4",
    "R 3",
    "U 1",
    "R 6",
    "D 6",
    "L 1",
    "R 9",
    "L 5",
    "R 8",
    "U 6",
    "D 2",
    "U 10",
    "D 2",
    "L 4",
    "U 7",
    "D 10",
    "L 7",
    "D 8",
    "L 8",
    "D 5",
    "L 8",
    "U 10",
    "D 7",
    "U 1",
    "L 9",
    "R 2",
    "U 6",
    "L 5",
    "R 2",
    "D 5",
    "L 3",
    "D 6",
    "L 2",
    "D 6",
    "L 2",
    "R 9",
    "D 7",
    "R 1",
    "L 7",
    "R 9",
    "D 11",
    "R 8",
    "U 1",
    "L 7",
    "R 3",
    "L 2",
    "U 4",
    "R 1",
    "D 10",
    "L 3",
    "R 9",
    "U 10",
    "R 1",
    "D 7",
    "R 6",
    "D 11",
    "U 2",
    "L 9",
    "R 10",
    "L 4",
    "R 6",
    "U 5",
    "L 1",
    "U 10",
    "D 6",
    "U 2",
    "L 11",
    "U 4",
    "R 3",
    "D 9",
    "U 1",
    "D 9",
    "L 9",
    "D 9",
    "U 5",
    "D 4",
    "U 2",
    "D 3",
    "L 8",
    "R 5",
    "D 7",
    "R 8",
    "D 4",
    "L 2",
    "U 4",
    "D 1",
    "L 9",
    "D 3",
    "R 7",
    "U 4",
    "L 2",
    "R 8",
    "L 2",
    "U 10",
    "D 9",
    "R 7",
    "U 8",
    "D 4",
    "U 3",
    "D 10",
    "L 3",
    "R 4",
    "L 5",
    "R 9",
    "L 8",
    "R 10",
    "U 5",
    "D 10",
    "R 3",
    "U 8",
    "R 2",
    "U 4",
    "D 1",
    "R 9",
    "L 2",
    "U 6",
    "L 1",
    "R 6",
    "D 9",
    "L 8",
    "U 8",
    "D 6",
    "L 7",
    "U 6",
    "D 1",
    "R 3",
    "D 6",
    "R 2",
    "D 7",
    "R 2",
    "D 11",
    "L 7",
    "U 9",
    "R 8",
    "L 10",
    "U 1",
    "R 11",
    "L 5",
    "D 1",
    "R 4",
    "D 9",
    "L 12",
    "U 2",
    "R 10",
    "D 2",
    "L 8",
    "R 2",
    "L 4",
    "R 1",
    "U 5",
    "R 8",
    "U 3",
    "D 12",
    "U 12",
    "L 11",
    "R 6",
    "L 1",
    "R 3",
    "L 9",
    "D 6",
    "L 10",
    "D 6",
    "U 4",
    "L 9",
    "U 5",
    "D 9",
    "R 9",
    "D 12",
    "R 4",
    "D 9",
    "L 4",
    "R 2",
    "L 9",
    "R 4",
    "D 3",
    "U 10",
    "L 8",
    "U 11",
    "D 12",
    "L 4",
    "D 2",
    "U 11",
    "L 9",
    "R 3",
    "U 6",
    "D 3",
    "L 12",
    "U 9",
    "D 2",
    "L 6",
    "R 3",
    "U 2",
    "D 3",
    "R 5",
    "L 10",
    "U 5",
    "D 2",
    "L 12",
    "R 8",
    "U 9",
    "R 4",
    "D 8",
    "R 3",
    "D 9",
    "L 11",
    "D 8",
    "U 10",
    "L 12",
    "R 4",
    "L 8",
    "R 7",
    "U 7",
    "L 9",
    "R 1",
    "D 5",
    "R 11",
    "U 2",
    "D 8",
    "L 11",
    "U 5",
    "R 2",
    "U 1",
    "L 5",
    "U 10",
    "D 2",
    "L 3",
    "U 5",
    "L 11",
    "U 3",
    "D 3",
    "U 11",
    "L 13",
    "D 7",
    "U 4",
    "L 12",
    "U 10",
    "L 13",
    "R 4",
    "L 12",
    "U 12",
    "D 4",
    "U 6",
    "D 5",
    "R 5",
    "U 13",
    "R 7",
    "D 2",
    "U 9",
    "L 7",
    "R 7",
    "D 2",
    "U 12",
    "D 5",
    "L 11",
    "D 13",
    "L 10",
    "D 10",
    "U 7",
    "D 13",
    "U 7",
    "R 9",
    "L 7",
    "R 1",
    "L 6",
    "R 9",
    "D 8",
    "U 7",
    "L 12",
    "D 9",
    "U 4",
    "D 13",
    "R 2",
    "L 8",
    "R 10",
    "D 8",
    "L 2",
    "D 5",
    "R 8",
    "D 2",
    "R 8",
    "D 4",
    "L 9",
    "R 4",
    "U 4",
    "L 13",
    "D 2",
    "L 3",
    "R 6",
    "U 5",
    "L 9",
    "U 9",
    "R 10",
    "L 11",
    "U 11",
    "D 13",
    "U 4",
    "L 2",
    "D 13",
    "R 9",
    "L 13",
    "D 9",
    "U 9",
    "D 5",
    "U 11",
    "L 8",
    "R 7",
    "U 11",
    "D 3",
    "L 5",
    "R 12",
    "D 2",
    "R 5",
    "L 10",
    "U 10",
    "D 10",
    "R 8",
    "L 2",
    "R 3",
    "U 9",
    "D 7",
    "U 14",
    "L 6",
    "D 11",
    "R 12",
    "L 13",
    "U 2",
    "L 11",
    "R 13",
    "D 13",
    "L 3",
    "R 3",
    "L 10",
    "R 11",
    "D 12",
    "R 8",
    "U 14",
    "D 4",
    "U 4",
    "L 12",
    "R 8",
    "L 10",
    "R 4",
    "U 12",
    "D 5",
    "L 3",
    "U 1",
    "D 7",
    "R 12",
    "L 4",
    "R 9",
    "U 5",
    "R 11",
    "D 12",
    "R 14",
    "L 7",
    "U 2",
    "L 7",
    "U 1",
    "D 8",
    "R 3",
    "U 7",
    "R 2",
    "L 2",
    "R 7",
    "D 3",
    "U 3",
    "R 5",
    "L 11",
    "U 13",
    "D 14",
    "L 7",
    "D 5",
    "R 11",
    "L 1",
    "U 5",
    "D 11",
    "U 2",
    "D 8",
    "L 10",
    "D 8",
    "R 5",
    "L 2",
    "U 11",
    "L 4",
    "R 7",
    "D 2",
    "L 4",
    "R 5",
    "L 6",
    "U 12",
    "L 9",
    "D 4",
    "R 8",
    "U 4",
    "L 2",
    "R 12",
    "D 11",
    "R 12",
    "U 10",
    "R 12",
    "U 9",
    "L 1",
    "U 4",
    "L 9",
    "U 13",
    "R 10",
    "L 9",
    "U 11",
    "R 6",
    "D 9",
    "L 1",
    "D 14",
    "R 1",
    "D 12",
    "U 5",
    "D 3",
    "U 13",
    "R 2",
    "L 9",
    "R 8",
    "D 7",
    "L 13",
    "R 11",
    "D 12",
    "L 6",
    "R 11",
    "L 8",
    "U 9",
    "D 5",
    "U 10",
    "R 8",
    "L 12",
    "D 6",
    "R 8",
    "U 5",
    "D 13",
    "R 3",
    "U 12",
    "L 1",
    "U 13",
    "D 4",
    "L 10",
    "U 7",
    "L 10",
    "U 13",
    "D 4",
    "R 13",
    "D 5",
    "R 15",
    "D 8",
    "U 13",
    "L 6",
    "U 14",
    "L 4",
    "R 11",
    "U 13",
    "D 8",
    "U 11",
    "D 2",
    "R 13",
    "L 14",
    "R 6",
    "L 3",
    "R 13",
    "L 11",
    "R 14",
    "L 6",
    "U 14",
    "D 2",
    "R 1",
    "L 6",
    "U 5",
    "D 13",
    "L 7",
    "R 6",
    "U 11",
    "R 10",
    "D 5",
    "U 11",
    "D 2",
    "L 3",
    "U 4",
    "L 2",
    "U 5",
    "R 14",
    "U 9",
    "D 9",
    "U 12",
    "R 15",
    "L 11",
    "R 15",
    "L 9",
    "R 14",
    "U 7",
    "D 11",
    "R 14",
    "D 14",
    "L 4",
    "U 4",
    "D 10",
    "R 10",
    "D 9",
    "L 14",
    "R 14",
    "D 11",
    "L 7",
    "R 9",
    "L 14",
    "U 11",
    "D 12",
    "L 13",
    "D 11",
    "U 4",
    "D 10",
    "U 14",
    "D 8",
    "U 12",
    "R 15",
    "U 1",
    "D 1",
    "U 11",
    "D 10",
    "L 6",
    "D 11",
    "U 11",
    "R 10",
    "L 7",
    "U 5",
    "L 13",
    "R 8",
    "U 9",
    "L 8",
    "U 12",
    "D 2",
    "R 11",
    "U 6",
    "R 5",
    "L 2",
    "U 9",
    "L 3",
    "R 3",
    "D 6",
    "L 15",
    "U 15",
    "L 10",
    "D 4",
    "U 13",
    "R 4",
    "U 7",
    "R 14",
    "U 13",
    "L 8",
    "R 14",
    "U 5",
    "L 7",
    "R 5",
    "D 4",
    "L 4",
    "U 12",
    "L 10",
    "D 9",
    "R 10",
    "U 9",
    "L 5",
    "D 16",
    "R 10",
    "D 7",
    "U 4",
    "R 14",
    "D 13",
    "R 10",
    "L 15",
    "D 16",
    "R 15",
    "L 4",
    "D 2",
    "L 6",
    "R 16",
    "U 5",
    "R 9",
    "U 16",
    "R 4",
    "U 11",
    "D 5",
    "U 2",
    "D 3",
    "L 11",
    "D 4",
    "L 4",
    "U 1",
    "L 7",
    "U 12",
    "R 15",
    "U 16",
    "R 12",
    "D 8",
    "R 3",
    "U 16",
    "L 4",
    "R 4",
    "D 12",
    "L 5",
    "R 6",
    "D 16",
    "L 13",
    "D 3",
    "L 13",
    "R 4",
    "L 6",
    "D 12",
    "U 12",
    "L 9",
    "D 2",
    "U 16",
    "D 10",
    "L 1",
    "U 3",
    "D 1",
    "L 8",
    "D 3",
    "L 7",
    "R 7",
    "L 3",
    "D 11",
    "U 13",
    "R 13",
    "U 12",
    "L 16",
    "D 1",
    "R 14",
    "L 11",
    "R 3",
    "D 13",
    "U 10",
    "R 14",
    "U 2",
    "L 1",
    "D 1",
    "U 9",
    "D 5",
    "U 9",
    "L 7",
    "U 7",
    "L 6",
    "D 16",
    "U 16",
    "L 7",
    "U 11",
    "D 16",
    "U 7",
    "D 15",
    "R 7",
    "L 15",
    "D 4",
    "R 14",
    "D 10",
    "U 16",
    "L 10",
    "U 10",
    "D 16",
    "L 12",
    "U 10",
    "R 6",
    "L 1",
    "U 7",
    "D 3",
    "L 1",
    "R 6",
    "D 1",
    "R 12",
    "U 1",
    "D 3",
    "U 10",
    "R 17",
    "L 2",
    "R 13",
    "L 4",
    "D 3",
    "U 9",
    "R 8",
    "U 3",
    "D 4",
    "L 17",
    "R 4",
    "L 9",
    "U 5",
    "D 16",
    "R 9",
    "U 17",
    "D 17",
    "U 5",
    "L 7",
    "U 9",
    "D 10",
    "R 14",
    "D 2",
    "U 2",
    "D 16",
    "L 2",
    "D 16",
    "U 17",
    "D 13",
    "U 4",
    "R 16",
    "D 12",
    "L 17",
    "R 10",
    "L 13",
    "R 17",
    "U 4",
    "D 17",
    "U 10",
    "R 12",
    "U 16",
    "D 6",
    "U 1",
    "L 1",
    "U 17",
    "R 6",
    "D 11",
    "L 3",
    "U 7",
    "L 12",
    "R 8",
    "U 16",
    "D 2",
    "U 12",
    "D 7",
    "U 9",
    "R 6",
    "U 7",
    "D 17",
    "U 6",
    "L 3",
    "U 7",
    "R 12",
    "L 16",
    "U 3",
    "R 12",
    "U 2",
    "D 3",
    "R 16",
    "L 4",
    "U 5",
    "L 8",
    "D 3",
    "R 9",
    "D 13",
    "R 2",
    "L 14",
    "R 2",
    "U 13",
    "R 14",
    "D 2",
    "U 16",
    "L 16",
    "D 11",
    "U 4",
    "L 3",
    "R 9",
    "U 12",
    "L 15",
    "U 8",
    "R 11",
    "L 16",
    "R 5",
    "U 6",
    "R 8",
    "U 16",
    "D 16",
    "L 3",
    "U 11",
    "R 9",
    "U 12",
    "D 18",
    "L 13",
    "D 3",
    "R 4",
    "L 10",
    "R 15",
    "U 13",
    "D 15",
    "U 12",
    "D 3",
    "L 1",
    "U 16",
    "L 3",
    "U 17",
    "L 10",
    "D 11",
    "R 16",
    "L 13",
    "R 18",
    "U 18",
    "R 7",
    "D 13",
    "R 15",
    "U 12",
    "R 1",
    "L 9",
    "U 16",
    "R 11",
    "L 11",
    "U 7",
    "R 14",
    "L 16",
    "U 3",
    "D 11",
    "U 17",
    "D 14",
    "U 14",
    "R 7",
    "U 4",
    "R 13",
    "U 4",
    "D 18",
    "U 14",
    "L 4",
    "R 5",
    "L 3",
    "R 14",
    "U 12",
    "D 17",
    "U 13",
    "D 8",
    "U 9",
    "L 1",
    "R 15",
    "U 3",
    "L 11",
    "R 5",
    "L 1",
    "D 14",
    "R 10",
    "U 16",
    "R 2",
    "U 17",
    "D 1",
    "L 5",
    "U 15",
    "R 4",
    "D 13",
    "R 5",
    "D 7",
    "L 3",
    "U 14",
    "R 7",
    "D 9",
    "L 9",
    "R 4",
    "U 6",
    "L 8",
    "U 3",
    "L 5",
    "D 4",
    "R 14",
    "L 13",
    "D 4",
    "U 13",
    "R 17",
    "L 14",
    "D 16",
    "R 1",
    "L 2",
    "D 8",
    "R 11",
    "L 10",
    "U 12",
    "R 4",
    "U 9",
    "L 4",
    "D 13",
    "L 10",
    "R 8",
    "L 1",
    "U 12",
    "L 16",
    "U 12",
    "D 9",
    "R 13",
    "L 2",
    "R 5",
    "L 1",
    "D 18",
    "U 6",
    "D 13",
    "U 17",
    "R 7",
    "U 5",
    "R 5",
    "L 12",
    "R 2",
    "U 4",
    "L 7",
    "U 11",
    "D 17",
    "L 7",
    "U 9",
    "D 1",
    "U 8",
    "L 15",
    "U 2",
    "D 9",
    "U 9",
    "D 10",
    "U 12",
    "R 19",
    "D 16",
    "L 10",
    "U 14",
    "L 18",
    "R 5",
    "U 6",
    "L 4",
    "U 18",
    "L 14",
    "R 2",
    "U 13",
    "D 18",
    "L 2",
    "U 6",
    "L 10",
    "D 9",
    "L 3",
    "D 1",
    "R 6",
    "U 7",
    "D 12",
    "U 1",
    "R 15",
    "U 7",
    "L 8",
    "R 8",
    "L 16",
    "U 8",
    "R 8",
    "U 11",
    "R 19",
    "U 2",
    "L 6",
    "R 1",
    "D 16",
    "U 3",
    "L 7",
    "D 10",
    "R 14",
    "D 11",
    "R 8",
    "U 14",
    "L 6",
    "D 14",
    "R 7",
    "U 18",
    "D 19",
    "R 4",
    "U 10",
    "R 14",
    "U 3",
    "L 12",
    "D 7",
    "U 18",
    "D 10",
    "L 8",
    "D 9",
    "L 6",
    "U 12",
    "R 1",
    "L 16",
    "R 2",
    "U 15",
    "R 14",
    "U 7",
    "L 6",
    "R 10",
    "D 18",
    "R 14",
    "U 3",
    "R 4",
    "D 17",
    "L 10",
    "U 19",
    "R 4",
    "D 12",
    "U 2",
    "D 18",
    "R 4",
};
#endif

static inline U8
fnv1a_len(void const *data, U4 len)
{
    U1 const *bytes = (U1 const *)data;
    U8 hash = 0xcbf29ce484222325;
    for(U4 i = 0; i < len; ++i)
    {
        U1 b = bytes[i];
        hash ^= b;
        hash *= 0x100000001b3;
    }
    return hash;
}

typedef struct { U4 x, y; } Pt;
typedef struct { Pt *pts; U4 m, n; } PtSet;

static inline U4
ceil_pow2_u4(U4 v)
{
    v--;
    v |= v >> 1;
    v |= v >> 2;
    v |= v >> 4;
    v |= v >> 8;
    v |= v >> 16;
    v++;
    return v;
}


U4
convert(S4 a)
{

    return a;
}


/* [           X        B         ] */
/*             v */
/*             A */
/*   0b010010101010111 */
/* & 0b000000000011111 */
/* ------------------- */
/*   0b000000000010111 */

/* infinite_idx % array_len */

U4 anding(U4 a, U4 b)
{
    return a & b;
}


int get_pt(PtSet *set, Pt pt, Pt **slot_out)
{
    if (pt.x == 0 && pt.y == 0) __debugbreak();

    U8 hash = fnv1a_len(&pt, sizeof(pt));
    U8 mask = set->m - 1;
    U4 i    = hash & mask;

    bool already_in = false;
    // find first unoccupied slot from initial hash position
    // or the pt already in the set
    for (; set->pts[i].x && set->pts[i].y; i = ++hash & mask)
    {
        if (pt.x == set->pts[i].x &&
            pt.y == set->pts[i].y)
        {   already_in = true; break;   }
    }

    if (slot_out) { *slot_out = &set->pts[i]; }

    return already_in;
}

void add_pt_to_set(PtSet *set, Pt pt)
{
    Pt *slot = NULL;
    if (! get_pt(set, pt, &slot))
    {
        *slot = pt;
        ++set->n;
    }
}

U4 absdiff(U4 a, U4 b)
{
    return (a > b
            ? a - b
            : b - a);
}

U4 aoc9(char const **ops, U4 ops_n)
{
    U4 max = ~(U4)0;
    U4 m = ceil_pow2_u4(ops_n * 4);
    PtSet set[1] = { calloc(sizeof(Pt), m), m };
    Pt head = { 1 << 31, 1 << 31 }, tail = head;
    add_pt_to_set(set, tail);

    for (U4 op_i = 0; op_i < ops_n; ++op_i)
    {
        char const *op = ops[op_i];
        char dir = 0;
        U4 rep_n = 0;
        sscanf(op, "%c %u", &dir, &rep_n);

        S4 move_x = 0, move_y = 0;
        switch (dir)
        {
            case 'R': move_x = +1; break;
            case 'L': move_x = -1; break;
            case 'U': move_y = +1; break;
            case 'D': move_y = -1; break;
            default: __debugbreak();
        }

        for (U4 rep_i = 0; rep_i < rep_n; ++rep_i)
        { // update positions
            Pt old_head = head;
            head.x += (U4)move_x;
            head.y += (U4)move_y;

            U4 dx = absdiff(head.x, tail.x);
            U4 dy = absdiff(head.y, tail.y);

            if (dx > 1 || dy > 1)
            {
                tail = old_head;
                add_pt_to_set(set, tail);
            }
        }
    }


    return set->n;
}

static Pt ZeroPt = { 1 << 31, 1 << 31 };

void draw_visited_pts(PtSet *sets, Pt *pts, U4 n)
{
    Pt min_pt = ZeroPt, max_pt = ZeroPt;
    for (U4 i = 0; i < sets[0].m; ++i)
    {
        Pt pt = sets[0].pts[i];
        if (pt.x && pt.y)
        {
            if (pt.x < min_pt.x) { min_pt.x = pt.x; }
            if (pt.y < min_pt.y) { min_pt.y = pt.y; }
            if (pt.x > max_pt.x) { max_pt.x = pt.x; }
            if (pt.y > max_pt.y) { max_pt.y = pt.y; }
        }
    }

    Pt size = { max_pt.x - min_pt.x, max_pt.y - min_pt.y };


    for (U4 y = min_pt.y; y <= max_pt.y; ++y)
    {
        printf("%3u: ", y - min_pt.y);
        {
            for (U4 x = min_pt.x; x <= max_pt.x; ++x)
            {
                bool printed = false;
                if (x == ZeroPt.x && y == ZeroPt.y)
                {   printed = !!printf("S");   }
                else
                {
                    for (U4 set_i = 0; set_i < n; ++set_i)
                    { // current position
                        if (x == pts[set_i].x && y == pts[set_i].y)
                        {   printed = !!printf("%u", set_i); break;   }
                    }

                    if (! printed)
                    { // previous positions
                        if (get_pt(&sets[n-1], (Pt){x,y}, NULL))
                        {   printed = printf("#");   }
                    }
                }
                if (! printed) // not visited
                {   printf(".");   }
            }
            printf("  ");
        }
        printf("\n");
    }
    printf("\n\n");
}

S4 sign(S4 a)
{
    return (a > 0) - (a < 0);
}

void
update_positions(PtSet *sets, char const *op, Pt *pts, Pt *old_pts, U4 pts_n)
{
    char dir = 0;
    U4 rep_n = 0;
    sscanf(op, "%c %u", &dir, &rep_n);

    S4 move_x = 0, move_y = 0;
    switch (dir)
    {
        case 'R': move_x = +1; break;
        case 'L': move_x = -1; break;
        case 'U': move_y = -1; break;
        case 'D': move_y = +1; break;
        default: __debugbreak();
    }

    for (U4 rep_i = 0; rep_i < rep_n; ++rep_i)
    { // update positions
        /* memcpy(old_pts, pts, sizeof(*pts)*pts_n); */
        pts[0].x += (U4)move_x;
        pts[0].y += (U4)move_y;
        add_pt_to_set(&sets[0], pts[0]);

        for (U4 pt_i = 1; pt_i < pts_n; ++pt_i)
        {
            // ......0...........
            // .....1............

            // .......0.......... dx == 2, dy == 1 : move_x = 1, move_y = 1
            // .....1............

            // .....1.0.......... dx == 2, dy == 0 : move_x = 1, move_y = 0

            // .....0.1.......... dx == -2, dy == 0 : move_x = -1, move_y = 0

            // ......10.......... dx == 1, dy == 0 : move_x = 0, move_y = 0

            S4 dx = pts[pt_i-1].x - pts[pt_i].x;
            S4 dy = pts[pt_i-1].y - pts[pt_i].y;
            bool move = dx < -1 || dx > 1 || dy < -1 || dy > 1;
            if (move)
            {
                S4 move_x = sign(dx); // never move directly on top
                S4 move_y = sign(dy);
                pts[pt_i].x += (U4)move_x;
                pts[pt_i].y += (U4)move_y;
            }


            add_pt_to_set(&sets[pt_i], pts[pt_i]);
        }
        if (dbg_print)
        {
            /* printf("%u-%u: {%d, %d} move: %c\n", rep_i, pt_i, dx, dy, (move ? 'Y' : 'N')); */
            draw_visited_pts(sets, pts, pts_n);
        }
    }
}

U4 aoc9b(char const **ops, U4 ops_n)
{
    Pt    pts[10] = {ZeroPt};
    PtSet sets[countof(pts)] = {0};

    if (ops_n)
    {
        U4 m = ceil_pow2_u4(ops_n * 32);
        for (U4 i = 0; i < countof(pts); ++ i)
        {
            sets[i] = (PtSet){ calloc(sizeof(Pt), m), m };
            pts[i] = pts[0];
            add_pt_to_set(&sets[i], pts[i]);
        }

        Pt old_pts[countof(pts)];
        for (U4 op_i = 0; op_i < ops_n; ++op_i)
        {
            if (dbg_print) printf("%s\n----\n", ops[op_i]);
            update_positions(sets, ops[op_i], pts, old_pts, countof(pts));
        }
        if (dbg_print) printf("------------------\n");
    }

    /* draw_visited_pts(sets, pts, countof(pts)); */
    return sets[countof(sets)-1].n;
}


int main()
{
    dbg_print = 0;
    U4 result = aoc9b(ops, countof(ops));
    printf("\n\nRESULT: %u\n", result);
}
